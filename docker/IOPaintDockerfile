FROM python:3.10-bullseye

# 安装系统依赖
RUN apt-get update && apt-get install -y --no-install-recommends \
    libgl1-mesa-glx \
    && rm -rf /var/lib/apt/lists/*

# 升级pip并安装IOPaint
RUN pip install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple
RUN pip install iopaint -i https://pypi.tuna.tsinghua.edu.cn/simple --break-system-packages

# 设置工作目录和模型存放路径
WORKDIR /app
RUN mkdir -p /app/models

# 暴露端口
EXPOSE 8080

# 设置启动命令
CMD ["iopaint", "start", "--model=lama", "--device=cpu", "--port=8080", "--model-dir=/app/models"]